!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="81c14856-c1e8-427a-bf43-23d61cee2e06",e._sentryDebugIdIdentifier="sentry-dbid-81c14856-c1e8-427a-bf43-23d61cee2e06")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[202],{97737:function(e,t,n){Promise.resolve().then(n.bind(n,92627)),Promise.resolve().then(n.bind(n,93928))},59264:function(e,t,n){"use strict";n.d(t,{A:function(){return r}});let r=(0,n(85922).k)("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",17)},92627:function(e,t,n){"use strict";n.d(t,{BrowserProviders:function(){return o}});var r=n(37821),i=n(18712),a=n(22257);function o(e){return(0,r.jsx)(i.Ym,{children:(0,r.jsx)(a.RV,{children:e.children})})}},17363:function(e,t,n){"use strict";n.d(t,{CQ:function(){return h},E7:function(){return c},LP:function(){return m},S7:function(){return d},qM:function(){return f}});var r=n(75005),i=n(77362),a=n(87601),o=n(18151),l=n(58078),s=n(17344),u=n(61153);function d(){var e;let t=(0,r.$)(),n=(0,u.BO)();return(0,i.useQuery)({queryKey:[null!==(e=null==n?void 0:n.id)&&void 0!==e?e:"","bookmarks"],queryFn:async()=>{var e;let{data:r}=await t.from("bookmark").select("*").order("updated_at",{ascending:!1}).eq("owner_id",null!==(e=null==n?void 0:n.id)&&void 0!==e?e:"");return r},enabled:!!n})}function c(e){let t=(0,r.$)(),n=(0,l.useContext)(s.Ec);return(0,i.useQuery)({queryKey:["pageBookmarks",e],queryFn:async()=>{let{data:r}=await t.from("bookmark").select("*").order("updated_at",{ascending:!1}).eq("site_id",e).eq("owner_id",n.id);return r},enabled:!!e&&!!n})}function h(){let e=(0,r.$)(),t=(0,a.useQueryClient)(),n=(0,l.useContext)(s.Ec);return(0,o.useMutation)({mutationFn:async t=>{let{id:n,...r}=t,{error:i,data:a}=await e.from("bookmark").update(r).eq("id",n).select("*").single();if(i)throw i;return a},onSuccess:async e=>{if(!n)throw Error("User must be logged in to update bookmark");return t.setQueryData(["bookmark",e.id],e),t.setQueryData([n.id,"bookmarks"],t=>t?[e,...t.filter(t=>t.id!==e.id)]:[e]),t.setQueryData(["pageBookmarks",e.site_id],t=>t?[e,...t.filter(t=>t.id!==e.id)]:[e]),e}})}function f(){let e=(0,r.$)(),t=(0,a.useQueryClient)(),n=(0,l.useContext)(s.Ec);return(0,o.useMutation)({mutationFn:async t=>{let{error:n,data:r}=await e.from("bookmark").insert(t).select("*").single();if(n)throw n;return r},onSuccess:async e=>{var r;return t.setQueryData(["bookmark",e.id],e),t.setQueryData([null!==(r=null==n?void 0:n.id)&&void 0!==r?r:"","bookmarks"],t=>t?[e,...t]:[e]),t.setQueryData(["pageBookmarks",e.site_id],t=>t?[e,...t]:[e]),e}})}function m(){let e=(0,r.$)(),t=(0,a.useQueryClient)(),n=(0,l.useContext)(s.Ec);return(0,o.useMutation)({mutationFn:async t=>{let{error:n}=await e.from("bookmark").delete().eq("id",t);if(n)throw n;return t},onSuccess:async e=>{var r;t.setQueryData(["bookmark",e],void 0),t.setQueryData([null!==(r=null==n?void 0:n.id)&&void 0!==r?r:"","bookmarks"],t=>t?t.filter(t=>t.id!==e):[]),t.setQueriesData({predicate:e=>"pageBookmarks"===e.queryKey[0]},t=>{if(t)return t.filter(t=>t.id!==e)})}})}},98448:function(e,t,n){"use strict";n.d(t,{k:function(){return u},t:function(){return s}});var r=n(75005),i=n(17344),a=n(58078),o=n(87601),l=n(77362);function s(){let e=(0,o.useQueryClient)();return(0,a.useCallback)(t=>{e.setQueryData(["history"],e=>e?[t,...e]:[t])},[e])}function u(){let e=(0,r.$)(),t=(0,a.useContext)(i.Ec);return(0,l.useQuery)({queryKey:[t.id,"history"],queryFn:async()=>{let{data:n,error:r}=await e.from("sites").select("id, title, url, method, command, created_at").eq("user_id",null==t?void 0:t.id).order("created_at",{ascending:!1});if(r)throw r;return n},enabled:!!t})}},93928:function(e,t,n){"use strict";n.d(t,{Browser:function(){return eI}});var r=n(37821),i=n(91341),a=n(77377),o=n(88202),l=n(92268),s=n(46587),u=n(75380),d=n(27950);let c=(0,n(85922).k)("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",17);var h=n(77452),f=n(58078);let m=(0,f.createContext)(null);var v=n(75005);async function x(e){let t=(0,v.e)();console.log(e),await t.auth.signInWithOAuth({provider:"google",options:{queryParams:{access_type:"online",prompt:"select_account"},redirectTo:"".concat(window.location.origin,"/auth/callback?next=").concat(e)}})}var g=n(11696),p=n(73164),w=n(68955),b=n(72056),y=n(84578),j=n.n(y),k=n(90168),C=n(53644),N=n(46302),E=n(59264),I=n(39565),P=n(64722),L=n(17344),R=n(77391),S=n(17363);function _(e){let{currentPage:t}=e,n=(0,f.useContext)(L.Ec),{data:i,error:a}=(0,S.E7)(null==t?void 0:t.id),{mutateAsync:o}=(0,S.qM)(),l=(0,f.useContext)(P.fP),s=async()=>{if(!n){x(window.location.href);return}if(i&&(null==t?void 0:t.id)){let e=i.length?i[0]:await o({site_id:t.id,title:t.title,id:(0,E.A)()});(0,R.Me)(e.id),(0,R.YD)(e.id),j()()?(0,R.nP)(!0):l("open_persist")}},d=!(null==t?void 0:t.id)||!!(null==t?void 0:t.id)&&(0,u.kM)(t.id);return(0,r.jsx)("button",{className:"hover:enabled:bg-gray-200 transition-all duration-300 ease-in-out p-1 rounded-full disabled:opacity-50 disabled:bg-none dark:hover:enabled:bg-neutral-600 disabled:opacity-20 disabled:cursor-default",disabled:d,"aria-label":"Bookmark this page",title:"Bookmark this page",type:"button",onClick:s,children:(0,r.jsx)(I.Z,{className:"\n          w-5 h-5\n          ".concat((null==i?void 0:i.length)?"stroke-yellow-400 fill-yellow-400 dark:stroke-sky-400 dark:fill-sky-400":"","\n        ")})})}var M=n(98448),T=n(56942);let D=C.z.object({type:C.z.literal("new_page"),id:C.z.string(),url:C.z.string(),clientIdsToIgnore:C.z.array(C.z.string())}),z=C.z.discriminatedUnion("type",[D]),U=e=>({log(t,n){console.log({message:t,...e,...n})},info(t,n){console.info({message:t,...e,...n})},warn(t,n){console.warn({message:t,...e,...n})},error(t,n){t instanceof Error?console.error({error:{message:t.message,name:t.name,status:t.status,stack:t.stack},data:n}):console.error({message:t,...e,...n})},debug(t,n){console.debug({message:t,...e,...n})}});var F=n(20327),O=n(39089),q=n(71786),B=n(87601),A=n(77362),Q=n(18151);function W(e){let t=(0,B.useQueryClient)(),n=(0,v.$)(),i=(0,f.useContext)(L.Ec),a=["likes",e.siteId],{data:o,error:l}=(0,A.useQuery)({queryKey:a,queryFn:async()=>{var t,r;let{data:a}=await n.from("likes").select("id,site_id").eq("site_id",null!==(t=e.siteId)&&void 0!==t?t:"").eq("user_id",null!==(r=null==i?void 0:i.id)&&void 0!==r?r:"").maybeSingle();return a},enabled:!!i&&!!e.siteId}),s=!!(null==o?void 0:o.site_id),{mutateAsync:d}=(0,Q.useMutation)({async mutationFn(){let{data:t,error:r}=await n.from("likes").insert({site_id:e.siteId}).single();if(r)throw Error(r.message);return fetch("https://images.websim.ai/v1/site/".concat(e.siteId,"/1200.jpeg")).then(()=>{}).catch(e=>{console.error("Error from image creation",e)}),t},onMutate(){t.setQueryData(a,{site_id:e.siteId})},onSuccess(){t.invalidateQueries({queryKey:a})}}),{mutateAsync:c}=(0,Q.useMutation)({async mutationFn(){if(!(null==o?void 0:o.id))return;let{data:e,error:t}=await n.from("likes").delete().eq("id",null==o?void 0:o.id).single();if(t)throw Error(t.message);return e},onMutate(){t.setQueryData(a,{})},onSuccess(){t.invalidateQueries({queryKey:a})}}),h=async()=>{if(!i){x(window.location.href);return}s?await c():await d()},m=!1;e.siteId&&(m=(0,u.kM)(e.siteId));let g=!e.siteId||m;return(0,r.jsx)("button",{className:"hover:enabled:bg-gray-200 transition-all duration-300 ease-in-out p-1 rounded-full disabled:opacity-50 disabled:bg-none dark:hover:enabled:bg-neutral-600 ml-2 disabled:opacity-20 disabled:cursor-default",disabled:g,"aria-label":"Like",title:"Like",type:"button",onClick:h,children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:s?"currentColor":"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-label":"Like",className:["w-5 h-5",s?"text-red-500 dark:text-teal-200":""].join(" "),children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z"})})})}var Z=n(23133),H=n(22449),V=n(42127),G=n(18712),K=n(22257);function $(e){let{iframeRef:t,setLoading:n,loading:i,navigatingRef:a,refreshPage:o,goHome:u,newTabMode:d}=e,c=(0,h.Iq)(),m=(0,q.Wo)(),v=(0,q.Yz)(),x=(0,q.$n)(),g=(0,f.useContext)(q.NT),p=(0,f.useContext)(G.fz),w=(0,f.useContext)(K.Bg),b=(0,f.useContext)(q.wC),y=(0,f.useContext)(q.vr),j=(0,f.useContext)(q.Tl),k=(0,f.useContext)(q.RJ),C=()=>{var e;m&&!m.id&&(y(j.slice(0,-1)),b(j.length-2)),n(!1),a.current=!1,null===(e=t.current.contentWindow)||void 0===e||e.stop(),w(!1)};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>{if(i&&!(null==m?void 0:m.id)){C();return}if(null==v?void 0:v.id){var e,n;let{url:r,id:i}=v;p(r),new URL("/api/html",window.location.origin).searchParams.set("id",i),null===(e=t.current.contentWindow)||void 0===e||e.stop(),b(g-1);let a=new URLSearchParams(window.location.search);a.has("b")&&(a.set("b",""),window.history.replaceState({},"","".concat(window.location.pathname,"?").concat(a.toString()))),null===(n=k.current)||void 0===n||n.call(k,i),w(!1)}},className:"hover:enabled:bg-gray-200 p-2 transition-all duration-300 ease-in-out rounded-full ml-2 disabled:opacity-50","aria-label":"Go Back",disabled:!v,children:(0,r.jsx)(H.Z,{className:"w-4 h-4"})}),(0,r.jsx)("button",{onClick:()=>{if(null==x?void 0:x.id){var e,n;let{url:r,id:i}=x;p(r),new URL("/api/html",window.location.origin).searchParams.set("id",i),null===(e=t.current.contentWindow)||void 0===e||e.stop(),b(g+1);let a=new URLSearchParams(window.location.search);a.has("b")&&(a.set("b",""),window.history.replaceState({},"","".concat(window.location.pathname,"?").concat(a.toString()))),null===(n=k.current)||void 0===n||n.call(k,i),w(!1)}},className:"hover:enabled:bg-gray-200 p-2 transition-all duration-300 ease-in-out rounded-full ml-2 disabled:opacity-50","aria-label":"Go Forward",disabled:!x,children:(0,r.jsx)(V.Z,{className:"w-4 h-4"})}),i?(0,r.jsx)("button",{onClick:C,className:"hover:enabled:bg-gray-200 transition-all duration-300 ease-in-out p-2 rounded-full","aria-label":"Cancel Load",children:(0,r.jsx)("svg",{width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{d:"M12.8536 2.85355C13.0488 2.65829 13.0488 2.34171 12.8536 2.14645C12.6583 1.95118 12.3417 1.95118 12.1464 2.14645L7.5 6.79289L2.85355 2.14645C2.65829 1.95118 2.34171 1.95118 2.14645 2.14645C1.95118 2.34171 1.95118 2.65829 2.14645 2.85355L6.79289 7.5L2.14645 12.1464C1.95118 12.3417 1.95118 12.6583 2.14645 12.8536C2.34171 13.0488 2.65829 13.0488 2.85355 12.8536L7.5 8.20711L12.1464 12.8536C12.3417 13.0488 12.6583 13.0488 12.8536 12.8536C13.0488 12.6583 13.0488 12.3417 12.8536 12.1464L8.20711 7.5L12.8536 2.85355Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"})})}):(0,r.jsxs)("button",{onClick:o,className:"hover:enabled:bg-gray-200 transition-all duration-300 ease-in-out p-2 rounded-full","aria-label":"Refresh Page",disabled:!c,children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})}),d&&(0,r.jsxs)("span",{className:"text-[8px] absolute -translate-x-1/2 text-gray-500 dark:text-neutral-200",children:[" ","new tab ↗"]})]}),(0,r.jsx)("button",{onClick:u,className:"hover:enabled:bg-gray-200 transition-all duration-300 ease-in-out p-2 rounded-full disabled:opacity-50","aria-label":"Go Home",title:"Home",disabled:c===s._w||c===l.XN,children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"})})})]})}let J=(0,f.createContext)(null);var X=n(24887),Y=n(16612);function ee(e){let[t,n]=(0,f.useState)(!1),i=()=>{e.siteId&&navigator.clipboard.writeText("https://websim.ai/c/".concat(e.siteId))},a=async()=>{if(e.siteId)try{let t="payload=".concat(encodeURIComponent(JSON.stringify({id:e.siteId,debug:"true",raw:"true"}))),n=await fetch("/api/html?".concat(t),{method:"GET"});if(!n.ok)throw Error("Network response was not ok");let r=await n.blob(),i=URL.createObjectURL(r),a="".concat(e.siteId,".html"),o=document.createElement("a");o.href=i,o.download=a,document.body.appendChild(o),o.click(),URL.revokeObjectURL(i),document.body.removeChild(o)}catch(e){console.error("Failed to download file:",e)}},o=!1;return e.siteId&&(o=(0,u.kM)(e.siteId)),(0,r.jsxs)(X.v2,{as:"div",className:"relative",children:[(0,r.jsx)(X.v2.Button,{className:["ml-1 hover:enabled:bg-gray-200 transition-all duration-300 ease-in-out p-1","dark:hover:enabled:bg-neutral-600","rounded-full disabled:opacity-50 disabled:bg-none",e.siteId?"":"opacity-20 cursor-default"].join(" "),"aria-label":"share",disabled:!e.siteId||o,children:(0,r.jsx)(Y.Z,{className:" w-5 h-5 "})}),(0,r.jsxs)(X.v2.Items,{className:"absolute top-full right-0 mt-2 py-2 w-48 bg-white rounded-md shadow-xl z-20",children:[(0,r.jsx)(X.v2.Item,{children:e=>{let{active:t}=e;return(0,r.jsx)("button",{className:["block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left",t?"bg-gray-100":""].join(" "),onClick:i,children:"Copy URL to clipboard"})}}),(0,r.jsx)(X.v2.Item,{children:t=>{let{active:n}=t;return(0,r.jsx)("button",{className:["block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left",n?"bg-gray-100":""].join(" "),onClick:a,disabled:e.isLoading,children:"Download Website"})}})]})]})}var et=n(50366),en=n(64816),er=n(3159),ei=n(34433),ea=n(78781),eo=n(290),el=n(80997),es=n(15685),eu=n(30675);function ed(e){let t=(0,k.usePathname)(),n=(0,el.W)(t),{profile:i,following:a}=(0,O.i)(e.siteId),o=(0,f.useContext)(L.Ti);return(null==n?void 0:n.type)==="profile"?(0,r.jsx)(ec,{username:n.username}):e.siteId&&((0,u.kM)(e.siteId)||e.useCurrentUser)?(0,r.jsx)(es.q,{user:null!=o?o:void 0,following:a}):(null==i?void 0:i.username)?(0,r.jsx)(es.q,{user:i,following:a}):(0,r.jsx)(es.q,{user:void 0,following:!1})}let ec=e=>{var t,n;let{username:i}=e,a=(0,eu.a)(i),{user:o,following:l}={user:null===(t=a.data)||void 0===t?void 0:t.user,following:(null===(n=a.data)||void 0===n?void 0:n.followed_at)!==void 0};return(0,r.jsx)(es.q,{user:o,following:l})};function eh(e){var t;let n=null!==(t=e.index)&&void 0!==t?t:Math.floor(3*Math.random());return(0,r.jsx)("div",{...e,className:"relative h-24 w-24 ".concat(n%3==0?"rotate-2":n%3==1?"-rotate-2":"-rotate-1"," hover:rotate-0 transition-transform duration-300 shadow-md rounded-lg ").concat(e.className||""),children:e.children})}function ef(e){return(0,r.jsx)("button",{className:"absolute -top-1 -right-1 text-xs text-gray-400 hover:text-gray-600 bg-white hover:opacity-80 p-1 rounded-full border border-gray-200",type:"button",onClick:e.onClick,children:(0,r.jsx)(en.Z,{className:"w-3 h-3 text-gray-800 pointer-events-none"})})}function em(e){return(0,r.jsx)("div",{className:"flex flex-row gap-6",children:e.attachments.map((e,t)=>(0,r.jsx)(ev,{file:e,index:t},e.id))})}function ev(e){let t=null;return e.file.mediaType.startsWith("image/")&&(t=(0,r.jsx)(ex,{file:e.file,index:e.index})),(0,r.jsx)("div",{className:"flex flex-col gap-2 pt-4 relative",children:t})}function ex(e){return(0,r.jsxs)(eh,{index:e.index,children:[(0,r.jsx)("img",{className:"object-cover w-full h-full rounded-lg",src:"/omegabus/attachment/".concat(e.file.id),alt:e.file.id}),(0,r.jsx)(eg,{id:e.file.id})]})}function eg(e){let t=(0,G.cS)();return(0,r.jsx)(ef,{onClick:n=>{n.preventDefault(),t(e.id)}})}var ep=n(38295);function ew(e){var t,n;let i=(0,f.useContext)(K.AW),a=(0,f.useContext)(K.Ao),o=(0,f.useContext)(K.qm),l=(0,f.useContext)(K.Bg),s=(0,f.useContext)(G.Tf),u=(0,f.useContext)(G.fz),d=(0,f.useContext)(L.Ec),c=(0,f.useContext)(h.cC),m=(0,f.useContext)(h.DE);(0,k.useSearchParams)().get("image_prompting"),(0,f.useEffect)(()=>{let e=e=>{if("l"===e.key&&(e.metaKey||e.ctrlKey)){var t,n;e.preventDefault(),null===(t=a.current)||void 0===t||t.focus(),null===(n=a.current)||void 0===n||n.select()}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[a]);let v=(0,G.Nr)(),g=(0,f.useContext)(J),{mutateAsync:p}=(0,G.HL)(),w=(0,f.useContext)(Z.n8),b=!(0,f.useContext)(h.pV)&&(null==m?void 0:null===(n=m.debug)||void 0===n?void 0:null===(t=n.messages)||void 0===t?void 0:t.some(e=>{var t;let n;return"assistant"===e.role&&(t=e.content,n=0,new et._b({onopentag:(e,t)=>{n++},onclosetag:e=>{n--}}).write(t),n>0)})),y=function(e){let[t,n]=(0,f.useState)(!1),r=(0,f.useContext)(G.fz);return(0,f.useEffect)(()=>{t&&(e(),n(!1))},[t,e]),(0,f.useCallback)(()=>{r("!continue"),n(!0)},[r])}(e.submit);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"fixed top-0 left-0 right-0 h-full w-full aria-hidden:hidden z-[1]","aria-hidden":!o,onClick:e=>{e.preventDefault(),l(!1)}}),(0,r.jsx)("div",{className:["z-20",j()()?"":"absolute","w-full z-[2]",j()()&&o?"fixed h-[100vh] w-[100vw] top-0 left-0 right-0":"",j()()&&o?"bg-white dark:bg-neutral-900":"",j()()&&o?"overflow-auto":""].join(" "),ref:i,children:(0,r.jsxs)("div",{className:[o?"ring-1 ring-gray-200/50 dark:ring-neutral-50/20":"",j()()&&o?"pt-10 pb-20":"",j()()?"":"p-3 -m-3",!j()()&&o?"overflow-y-auto rounded-lg bg-white dark:bg-neutral-900 shadow-lg":""].join(" "),children:[j()()&&(0,r.jsxs)("div",{className:"absolute top-0 right-0 left-0 m-4 flex items-center aria-hidden:hidden","aria-hidden":!o,children:[(0,r.jsx)("div",{className:"flex-1 flex flex-row items-center gap-2",children:g}),(0,r.jsx)("button",{className:" flex items-center justify-center w-6 h-6 bg-gray-100 text-gray-800 font-bold p-1 rounded dark:bg-neutral-500 dark:text-neutral-100 ",onClick:e=>{e.preventDefault(),l(!1)},type:"button",children:(0,r.jsx)(en.Z,{className:"w-4 h-4 pointer-events-none"})})]}),(0,r.jsxs)("div",{className:["flex flex-col gap-2 relative",j()()?"":"max-h-[calc(100vh-8rem)]",j()()&&o?"px-2 pt-2":""].join(" "),children:[(0,r.jsx)("div",{className:[o&&j()()?"mt-3 -mb-2":"","transition-all duration-100 ease-in-out","p-1 box-border min-w-0 w-full",o?"bg-gray-200/80 dark:bg-neutral-800":"bg-white dark:bg-neutral-900","z-0",o?"rounded-lg":"rounded-3xl","mb-1"].join(" "),children:(0,r.jsxs)("div",{className:"flex flex-row items-start gap-2",children:[(0,r.jsx)(ed,{siteId:c,useCurrentUser:o}),(0,r.jsxs)("div",{className:"flex flex-col gap-1 flex-1",children:[(0,r.jsx)(ey,{name:"url","aria-label":"URL",value:s,onChange:e=>u(e.currentTarget.value),className:["w-full bg-transparent focus:outline-none text-mono p-0 m-0 resize-none overflow-hidden text-ellipsis break-all text-base/5","overflow-y-auto",o?"":"whitespace-nowrap","pt-[2px]"].join(" "),minRows:1,maxRows:o?14:1,ref:a,placeholder:"What would you like to create today?",onFocus:e=>{if(!d){x(window.location.href);return}e.target.select()},onMouseUp:e=>{l(!0)},onKeyDown:t=>{"Escape"===t.key&&m&&u(m.url),"Enter"!==t.key||t.shiftKey||(t.preventDefault(),e.submit())}}),o&&w&&w.attachments&&w.attachments.length>0&&(0,r.jsx)(em,{attachments:w.attachments}),(0,r.jsx)("div",{className:["flex flex-col gap-2 aria-hidden:hidden","pt-4 text-gray-500 pl-[2px]",o?"":"hidden"].join(" "),"aria-hidden":!o,children:(0,r.jsx)("div",{className:"",children:o&&(0,r.jsx)(eb,{})})})]}),(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[o&&(0,r.jsx)("button",{className:" text-gray-500 bg-white p-1 rounded-lg hover:opacity-70 dark:bg-neutral-500 dark:text-gray-100 ",onClick:e=>{e.preventDefault(),e.stopPropagation();let t=document.createElement("input");t.type="file",t.accept="image/*",t.onchange=e=>{let t=e.target.files;if(!t||0===t.length){console.error("No files selected");return}let n=t[0],r=new FileReader;r.onload=async e=>{await p(e.target.result)},r.readAsDataURL(n)},t.click()},children:(0,r.jsx)(er.Z,{className:"w-4 h-4 pointer-events-none"})}),o&&(0,r.jsx)("button",{className:"text-white bg-gray-500 p-1 rounded-lg hover:opacity-70 dark:bg-blue-500 dark:text-gray-100",children:(0,r.jsx)(ei.Z,{className:["w-4 h-4 transform transition-transform duration-50",e.newTabMode?"-rotate-45 -translate-y-px  translate-x-px ":""].join(" ")})}),b&&(0,r.jsx)("button",{className:"text-gray-800 bg-gray-200 rounded-lg hover:opacity-70 text-sm h-6 px-2 dark:text-gray-300 dark:bg-gray-700",onClick:()=>{y()},children:"Continue?"}),!o&&v&&(0,r.jsx)("div",{className:"flex flex-row items-center gap-2 h-6 w-4",children:(0,r.jsx)("div",{className:"w-2 h-2 bg-gray-500 rounded-full"})})]})]})}),(0,r.jsx)("div",{className:[o?"":"hidden"].join(" "),children:(0,r.jsx)(ep.ZV,{})})]})]})})]})}function eb(){let e=(0,f.useContext)(G.jc),t=(0,f.useContext)(G.aX);return(0,r.jsxs)(ea.Ph.Root,{value:e,onValueChange:t,defaultValue:"sonnet",children:[(0,r.jsx)(ea.Ph.Trigger,{variant:"ghost",className:""}),(0,r.jsxs)(ea.Ph.Content,{position:"popper",className:"z-10 group",children:[(0,r.jsxs)(ea.Ph.Group,{children:[(0,r.jsx)(ea.Ph.Label,{children:"Anthropic"}),(0,r.jsx)(ea.Ph.Item,{value:"sonnet",children:(0,r.jsxs)("span",{className:"flex flex-row justify-between items-center group-data-[state=open]:w-48",children:[(0,r.jsxs)("span",{children:["Sonnet ",(0,r.jsx)("span",{className:"opacity-50",children:"3.5"})]}),(0,r.jsx)("span",{className:"text-xs opacity-50 hidden group-data-[state=open]:block",children:"Smartest & Fast"})]})})]}),(0,r.jsx)(ea.Ph.Separator,{}),(0,r.jsxs)(ea.Ph.Group,{children:[(0,r.jsx)(ea.Ph.Label,{children:"OpenAI"}),(0,r.jsx)(ea.Ph.Item,{value:"gpt-4o",children:(0,r.jsxs)("span",{className:"flex flex-row justify-between items-center group-data-[state=open]:w-48",children:[(0,r.jsx)("span",{children:"GPT-4o"}),(0,r.jsx)("span",{className:"text-xs opacity-50 hidden group-data-[state=open]:block",children:"Experimental"})]})})]}),(0,r.jsx)(ea.Ph.Separator,{}),(0,r.jsxs)(ea.Ph.Group,{children:[(0,r.jsx)(ea.Ph.Label,{children:"Legacy models"}),(0,r.jsx)(ea.Ph.Item,{value:"haiku",children:(0,r.jsxs)("span",{className:"flex flex-row justify-between items-center group-data-[state=open]:w-48",children:[(0,r.jsx)("span",{children:"Haiku"}),(0,r.jsx)("span",{className:"text-xs opacity-50 hidden group-data-[state=open]:block",children:"Fast"})]})}),(0,r.jsx)(ea.Ph.Item,{value:"claude-3-sonnet",children:(0,r.jsxs)("span",{className:"flex flex-row justify-between items-center group-data-[state=open]:w-48",children:[(0,r.jsxs)("span",{children:["Sonnet ",(0,r.jsx)("span",{className:"opacity-50",children:"3"})]}),(0,r.jsx)("span",{className:"text-xs opacity-50 hidden group-data-[state=open]:block",children:"Balanced"})]})}),(0,r.jsx)(ea.Ph.Item,{value:"opus",children:(0,r.jsxs)("span",{className:"flex flex-row justify-between items-center group-data-[state=open]:w-48",children:[(0,r.jsx)("span",{children:"Opus"}),(0,r.jsx)("span",{className:"text-xs opacity-50 hidden group-data-[state=open]:block",children:"Smart"})]})})]})]})]})}let ey=(0,f.forwardRef)(function(e,t){let{mutateAsync:n}=(0,G.HL)();return(0,r.jsx)(eo.Z,{ref:t,...e,onPaste:e=>{var t;let r=null===(t=e.clipboardData)||void 0===t?void 0:t.items;if(r)for(let t=0;t<r.length;t++){let i=r[t];if(-1!==i.type.indexOf("image")){e.preventDefault();let t=i.getAsFile(),r=new FileReader;if(r.onload=e=>{n(e.target.result)},!t)throw alert("unimplemented"),Error("No blob");r.readAsDataURL(t);break}}}})});class ej{stop(){var e;null===(e=this.worker)||void 0===e||e.terminate()}constructor(e,t){this.worker=null;let n=new Blob(["setInterval(() => postMessage(0), ".concat(t,");")]),r=URL.createObjectURL(n);this.worker=new Worker(r),this.worker.onmessage=e}}class ek{startFaviconAnimation(){var e;null===(e=this.interval)||void 0===e||e.stop(),this.interval=new ej(this.setFavicon,16)}stopFaviconAnimation(){var e;null===(e=this.interval)||void 0===e||e.stop()}constructor(){this.interval=null,this.ready=!1,this.a=0,this.setFavicon=()=>{if(!this.ctx)return;this.ctx.clearRect(0,0,32,32),this.ctx.resetTransform(),this.ctx.translate(16,16),this.ctx.rotate(this.a),this.ctx.translate(-16,-16),this.a-=.1,this.ready&&this.ctx.drawImage(this.faviconImg,0,0);let e=document.getElementById("swirl-favicon");e&&e.remove();var t=document.createElement("link");t.type="image/x-icon",t.rel="shortcut icon",t.href=this.canvas.toDataURL("image/x-icon"),t.id="swirl-favicon",document.getElementsByTagName("head")[0].appendChild(t)},this.faviconImg=new Image,this.faviconImg.src="/favicon.ico",this.faviconImg.crossOrigin="anonymous",this.ready=!1,this.faviconImg.onload=()=>{this.ready=!0},this.canvas=document.createElement("canvas"),this.canvas.width=32,this.canvas.height=32,this.ctx=this.canvas.getContext("2d")}}let eC=["https://twitter.com/websim_ai","https://discord.gg/websim","https://www.reddit.com/r/WebSim","https://discord.com/channels/1223113914271793282/1223511479043489873/1242269156221390848"];function eN(e){if(eC.includes(e))return{url:e,target:"_blank"};if("https://websim.ai/auth/login"===e)return{url:"/auth/login",target:"_self"};let t=function(e){let t=e.split("websim.ai");if(t.length<2)return;let n=t[0],r=t.slice(1).join("websim.ai");if(""===n||"https://"===n||"https://"===n)return"https://websim.ai".concat(r)}(e);if(t){if(e===l.BM)return{url:e,target:"_self"};if(/^https:\/\/websim\.ai\/c\/[a-zA-Z0-9]{17}(\?.*)?$/.test(t)){let e=eE(t);if(e)return{url:e,target:"_self"}}if(/^https:\/\/websim\.ai\/@\w+/.test(t)){let e=eE(t);if(e)return{url:e,target:"_self"}}}if(/^@\w+(\/.*)?$/.test(e)){let t=eE("https://websim.ai/".concat(e));if(t)return{url:t,target:"_self"}}}function eE(e){let t="";try{t=new URL(e).pathname}catch(t){console.log("Invalid URL:",e);return}return(0,g.l)(e=>{e.pathname=t})}function eI(e){var t,n,y,E,I,P,S,D,B;let A=(0,f.useRef)(e);A.current=e;let Q=(0,k.useRouter)(),H=(0,p.O9)(),V=(0,f.useRef)(null),X=(0,f.useRef)(null),Y=(0,f.useRef)(!1),[et,en]=(0,h.r$)(),er=(0,f.useRef)(et);er.current=et;let[ei,ea]=(0,f.useState)(""),eo=(0,f.useContext)(q.Tl),el=(0,f.useContext)(q.vr),es=(0,f.useRef)(eo);es.current=eo;let eu=(0,f.useContext)(q.NT),ed=(0,f.useContext)(q.wC),ec=(0,f.useRef)(eu);ec.current=eu;let eh=(0,f.useContext)(q.RJ),ef=eo[eu],em=eo[eu-1],ev=(0,f.useContext)(G.Ug),ex=(0,f.useContext)(G.E6),eg=(0,f.useRef)(null!==(t=null==ef?void 0:ef.title)&&void 0!==t?t:"");eg.current=null!==(n=null==ef?void 0:ef.title)&&void 0!==n?n:"";let ep=(0,f.useRef)(null!==(y=null==ef?void 0:ef.url)&&void 0!==y?y:"");ep.current=null!==(E=null==ef?void 0:ef.url)&&void 0!==E?E:"";let eb=(0,f.useContext)(G.fz),ey=(0,f.useContext)(K.qm),ej=(0,f.useMemo)(()=>new Map,[]),eC=(0,f.useMemo)(()=>new Map,[]),eE=(0,f.useContext)(N.Sg),eI=(0,f.useContext)(L.Ec),eL=(0,f.useRef)(eI);eL.current=eI;let eM=(0,f.useRef)(ef);eM.current=ef;let eT=(0,f.useContext)(K.Ao),eD=null!==(I=(0,f.useContext)(G.jc))&&void 0!==I?I:"sonnet",ez=(0,f.useRef)(eD);ez.current=eD;let eU=(0,f.useContext)(Z.n8),eF=(0,f.useRef)(eU);eF.current=eU;let eO=(0,f.useContext)(h.ze),eq=(0,f.useRef)(eO);eq.current=eO;let eB=function(){let e=(0,k.useRouter)(),t=(0,f.useRef)(null),n=(0,v.$)(),r=(0,f.useContext)(h.tT),i=(0,f.useContext)(h.o2);return(0,f.useEffect)(()=>{let a=new URL(window.location.href).searchParams.get("session_id");if(!a)return;let o=(0,F.SX)({supabase:n,logger:U({}),cfPagesBranch:r,cfPagesCommitSha:i},{room:"session-".concat(a),party:"session"});return o.addEventListener("message",s),o.addEventListener("open",l),o.id,t.current=o,()=>{o.removeEventListener("message",s),o.removeEventListener("open",l)};function l(){console.log("connected to session")}function s(t){let n=z.safeParse(JSON.parse(t.data));if(n.success&&"new_page"===n.data.type){let{id:t}=n.data;e.push((0,g.l)(e=>{e.pathname="/c/".concat(t)}))}}},[e,n]),t}(),eA=(0,f.useContext)(m),eQ=(0,f.useContext)(K.Bg),eW=(0,O.$)(),eZ=(0,f.useContext)(L.Ti),eH=(0,f.useRef)(null);eH.current={loadPage:eh.current,cacheProfileForSite:eW,currentUserProfile:{username:null!==(P=null==eZ?void 0:eZ.username)&&void 0!==P?P:"",avatarUrl:null!==(S=null==eZ?void 0:eZ.avatar_url)&&void 0!==S?S:""}},(0,f.useEffect)(()=>{if(null==eA?void 0:eA.title){document.title=eA.title;return}(null==ef?void 0:ef.title)&&(ef.id&&eC.set(ef.id,ef.title),document.title=ef.title)},[null==ef?void 0:ef.id,null==ef?void 0:ef.title,null==eA?void 0:eA.title,eC]);let eV=(0,M.t)(),eG=(0,f.useContext)(h.o2);(0,f.useEffect)(()=>{!function(e,t,n){let r=r=>{var i;let a=n();if(a&&r.source===a&&(null===(i=r.data)||void 0===i?void 0:i.name)===e){let{id:e,fn:n,args:i}=r.data,o=t[n](...i);o&&"function"==typeof o.then?o.then(t=>{a.postMessage({id:e,result:t},a.origin)},t=>{a.postMessage({id:e,error:t},a.origin)}):a.postMessage({id:e,result:o},a.origin)}};window.addEventListener("message",r),()=>{window.removeEventListener("message",r)}}("parent",{setLoaded:function(){en(!1)},setProgress:function(e){ea(t=>t+e)},setReady:function(e){let{id:t,version:n,title:r,url:l,method:s,body:c,command:h}=e;if(n&&eG&&n!==eG){console.log("Version mismatch",n,eG),window.location.reload();return}if(Y.current=!1,!t||!l)return;let f={id:t,url:l,title:r,method:s,body:c,command:h,debug:{messages:[{id:"".concat(t,"-user"),role:"user",content:"GET"===s?(0,d.ZD)(l):"POST"===s?(0,d.tk)(l,c):(0,d.RH)(null!=h?h:"")}]}};eE({messages:eo.flatMap(e=>{var t,n;return null!==(n=null===(t=e.debug)||void 0===t?void 0:t.messages)&&void 0!==n?n:[]})}),f.title||(f={...f,title:(0,i.v)(f.url)}),f.id&&eC.has(f.id)&&(f={...f,title:eC.get(f.id)}),eg.current=f.title,ep.current=f.url,el([...es.current.slice(0,ec.current),f,...es.current.slice(ec.current+1)]);let m=(0,a.l9)(f.url);if(f.id&&!(0,u.kM)(f.id)&&eb(m),t!==o.j){let e=(0,u.kM)(t)?(0,g.l)(e=>{e.pathname="/"}):(0,g.l)(e=>{e.pathname=(0,g.z)(f.id)});window.location.href!==e&&window.history.pushState({},"",e)}f.id&&eV({id:f.id,created_at:new Date().toISOString(),title:f.title,url:f.url})},getFetchParams:async()=>({websimUpdateVersion:0}),handleClientOutdated:async()=>{window.confirm("A new version of the Websim client is available. Refresh?")&&window.location.reload()},navigate:function(e){var t,n,r,a;let{method:o,url:l,target:s,body:u,command:h}=e,f="_blank"===s&&"opus"!==ez.current;if("GET"===o&&l){let{url:e,target:t}=null!==(n=eN(l))&&void 0!==n?n:{};if(e){"_blank"===t||f?window.open(e,"_blank"):Q.push(e);return}}if(!er.current&&!Y.current){if(!eL.current){x(window.location.href);return}if(null===(t=eM.current)||void 0===t?void 0:t.id){l||(l=eM.current.url);let e={currentId:null===(r=eM.current)||void 0===r?void 0:r.id,promptSource:"page",apiKey:(0,T.Pi)(),model:ez.current,clientId:null===(a=eB.current)||void 0===a?void 0:a.id,siteId:c(),lore:eF.current};f||(el([...es.current.slice(0,ec.current+1),{id:e.siteId,url:l,title:(0,i.v)(l),method:o,body:u,debug:{messages:[{id:"".concat(e.siteId,"-user"),role:"user",content:"GET"===o?(0,d.ZD)(l):"POST"===o?(0,d.tk)(l,u):(0,d.RH)(null!=h?h:"")}]}}]),ed(ec.current+1),eb(l),en(!0),Y.current=!0),"eval"===o&&eP({method:o,command:null!=h?h:"",...e},eH.current,f),"GET"===o&&eP({method:o,url:l,...e},eH.current,f),"POST"===o&&eP({method:o,url:l,body:u,...e},eH.current,f)}}},reload:function(){e$()},setHash:function(e){let t="".concat(eM.current.url.split("#")[0]).concat(e);eb(t),el([...es.current.slice(0,ec.current),{...es.current[ec.current],url:t},...es.current.slice(ec.current+1)])},setTitle:function(e){eg.current=e,el([...es.current.slice(0,ec.current),{...es.current[ec.current],url:ep.current,title:e},...es.current.slice(ec.current+1)])},focusUrl:function(){var e;null===(e=eT.current)||void 0===e||e.focus()},login:function(){x(window.location.href)},logout:function(){eS()},saveHtml:async e=>{let{html:t,parent_id:n}=e,r=await fetch("/api/experimental/v0/site",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:t,parent_id:n})});if(!r.ok)throw Error("Failed to save websim");let i=await r.json();return C.z.object({id:C.z.string()}).parse(i)},getHtml:async e=>{let t=await fetch("/api/experimental/v0/site/".concat(e),{method:"GET"});if(!t.ok)throw Error("Failed to load websim html");let n=await t.json(),{content:r}=C.z.object({content:C.z.string()}).parse(n);return r},generateImage:async e=>{let t=await fetch("/api/image_gen",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("Error: ".concat(t.status));let n=await t.json();return C.z.object({url:C.z.string(),rewritten_prompt:C.z.string()}).parse(n)},getPlugins(){let e=new URLSearchParams(window.location.search).getAll("plugin"),t=window.location.origin;return Promise.all(e.map(async e=>(await fetch("/api/html/".concat(e)).then(e=>{if(!e.ok)throw Error("Failed to load plugin");return e.text()})).replaceAll("https://websim.ai",t)))},getParams:()=>Promise.resolve({pathname:window.location.pathname})},()=>{var e;return null===(e=V.current)||void 0===e?void 0:e.contentWindow})},[]);let eK=t=>{if(t===eJ)return;e_(e.view_uuid);let n=ej.get(t);n&&A.current.html?(V.current.srcdoc=n,en(!1),Y.current=!1):(en(!0),Y.current=!0),Q.push((0,g.l)(e=>{e.pathname=(0,g.z)(t)}))};eh.current=eK,(0,f.useEffect)(()=>{ea(""),et?(window.favicon||(window.favicon=new ek),window.favicon.startFaviconAnimation()):(window.favicon||(window.favicon=new ek),window.favicon.stopFaviconAnimation())},[et]);let e$=()=>{if(ef){var e;if(!eI){x(window.location.href);return}let{url:t,method:n,body:r,command:a}=ef,o={currentId:null==em?void 0:em.id,url:t,body:r,apiKey:(0,T.Pi)(),model:ez.current,clientId:null===(e=eB.current)||void 0===e?void 0:e.id,siteId:c(),lore:eq.current};ev||(eb(t),el([...eo.slice(0,eu+1),{id:o.siteId,url:t,title:(0,i.v)(t),method:n,body:r,command:a,debug:{messages:[{id:"".concat(o.siteId,"-user"),role:"user",content:"GET"===n?(0,d.ZD)(t):"POST"===n?(0,d.tk)(t,r):(0,d.RH)(null!=a?a:"")}]}}]),en(!0),Y.current=!0,new URLSearchParams(window.location.search)),"eval"===n?eP({method:n,command:null!=a?a:"",...o},eH.current,ev):eP({method:n,...o},eH.current,ev)}},eJ=(0,h.Iq)();(0,f.useEffect)(()=>{eJ&&!A.current.html&&(en(!0),Y.current=!0)},[]);let eX=eR({id:eJ},(0,k.usePathname)()),eY=(0,p.HV)(),[e0,e1]=(0,f.useState)(!1),e2=(0,r.jsx)($,{iframeRef:V,setLoading:en,loading:et,navigatingRef:Y,refreshPage:e$,goHome:()=>{el([]),ed(0),eK(eI?s._w:l.XN)},newTabMode:ev});return(0,r.jsx)(J.Provider,{value:e2,children:(0,r.jsxs)("div",{id:"browser",className:["@container bg-clip-padding relative flex-1 flex flex-col items-stretch","ring-1 ring-gray-200/50 dark:ring-neutral-50/20","bg-white dark:bg-neutral-950",H?"":"rounded-lg"].join(" "),children:[eY?(0,r.jsx)("div",{className:"absolute h-[1px] w-full top-0 left-0 z-10",onMouseEnter:()=>{e1(!0)}}):null,(0,r.jsxs)("div",{className:["flex flex-col items-stretch w-full bg-gray-100 dark:bg-neutral-700",j()()?"fixed z-10 top-0":"",eY?"":j()()?"":"rounded-t-lg",eY&&!e0?"hidden":"",eY&&e0?"absolute z-10":""].join(" "),children:[(0,r.jsxs)("div",{className:["p-[6px] flex items-center justify-between h-[44px] gap-2",j()()?"pt-0":""].join(" "),children:[(0,r.jsxs)("div",{className:"flex flex-1 items-center justify-start ".concat(j()()?"hidden":""),children:[(0,r.jsxs)("div",{className:"hidden @lg:flex",children:[(0,r.jsx)("div",{className:"bg-red-500 dark:bg-teal-200 h-3 w-3 rounded-full mx-1"}),(0,r.jsx)("div",{className:"bg-yellow-400 dark:bg-sky-400 h-3 w-3 rounded-full mx-1"}),(0,r.jsx)(w.z,{onClick:()=>{let e=(0,p.fk)();(0,p.kL)(!e)},children:(0,r.jsx)("div",{className:"bg-green-500 dark:bg-pink-300 h-3 w-3 rounded-full mx-1 flex items-center justify-center group",children:(0,r.jsxs)("svg",{width:"6",height:"7",viewBox:"0 0 6 7",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"w-2 h-2 group-hover:opacity-50 opacity-0",children:[(0,r.jsx)("path",{d:"M0.5 4V1H3.5L0.5 4Z",fill:"black"}),(0,r.jsx)("path",{d:"M5.5 3L2.5 6H5.5V3Z",fill:"black"}),(0,r.jsx)("path",{d:"M0.5 4V1H3.5L0.5 4Z",stroke:"black"}),(0,r.jsx)("path",{d:"M5.5 3L2.5 6H5.5V3Z",stroke:"black"})]})})})]}),!j()()&&e2]}),j()()?null:(0,r.jsx)("div",{className:"flex flex-grow-1 flex-shrink-1 items-center justify-center basis-[800px]",children:e5()}),(0,r.jsxs)("div",{className:"flex flex-1 items-center ".concat(j()()?"justify-between":"justify-end"),children:[j()()&&(0,r.jsx)("button",{onClick:()=>{(0,R.nP)(!0)},className:"hover:enabled:bg-gray-200 transition-all duration-300 ease-in-out p-1 rounded-full disabled:opacity-50 disabled:bg-none",children:(0,r.jsx)(b.Z,{className:"w-5 h-5"})}),(0,r.jsx)(_,{currentPage:ef}),(0,r.jsx)(W,{siteId:null!==(D=null==ef?void 0:ef.id)&&void 0!==D?D:null,isLoading:!1}),(0,r.jsx)(ee,{siteId:null!==(B=null==ef?void 0:ef.id)&&void 0!==B?B:null,isLoading:!1})]})]}),j()()?(0,r.jsx)("div",{className:"p-2 flex items-center justify-between h-12 flex-0 -mt-4",children:e5()}):null]}),(0,r.jsxs)("div",{className:["flex-1 absolute left-0 right-0 bottom-0 overflow-hidden",j()()?"top-[76px]":"6",eY?"top-0":"top-11"].join(" "),onMouseEnter:()=>{e1(!1)},children:[(0,r.jsxs)("div",{className:"relative group",children:[(0,r.jsx)("div",{className:["bg-blue-500 absolute left-0 z-[1] min-w-16 transition-width transition-opacity",eY&&e0?"top-11":"top-0",""===ei?"animate-pulse ":""].join(" "),style:{opacity:et?1:0,padding:et?2:0,width:100-100/(1+ei.length/500)+"%"}}),et&&(0,r.jsx)("div",{className:"bg-blue-500 absolute -top-0 flex whitespace-nowrap justify-end left-0 z-[1] text-white text-xs h-0 group-hover:h-4 overflow-hidden cursor-default	",style:{transition:"height 0.1s ease-in-out",width:ei.length>0?"100%":"auto"},children:ei||"Initializing..."})]}),(0,r.jsx)("iframe",{ref:V,src:eX||void 0,srcDoc:e.html||void 0,name:"contentWindow",className:[ey?"pointer-events-none":"","absolute inset-0 w-full h-full bottom-0 border-none delay-500 bg-white dark:bg-neutral-900",H?"":"rounded-b-lg"].join(" "),onLoad:()=>{var e,t,n,r,i,a,o,l;{let e=null===(l=V.current)||void 0===l?void 0:null===(o=l.contentWindow)||void 0===o?void 0:o.document.documentElement.innerHTML;e&&(null==ef?void 0:ef.id)&&!ej.has(ef.id)&&ef.id!=s._w&&ej.set(ef.id,e)}null==V||null===(n=V.current)||void 0===n||null===(t=n.contentDocument)||void 0===t||null===(e=t.body)||void 0===e||e.addEventListener("keydown",e=>{ex(e.metaKey)}),null==V||null===(a=V.current)||void 0===a||null===(i=a.contentDocument)||void 0===i||null===(r=i.body)||void 0===r||r.addEventListener("keyup",e=>{ex(e.metaKey)}),en(!1),Y.current=!1},onAbort:()=>{en(!1),Y.current=!1},onError:()=>{en(!1),Y.current=!1}})]})]})});function e5(){return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("form",{ref:X,action:"/api/html",method:"POST",className:"flex-grow relative",onSubmit:e=>{var t,n,r;if(e.preventDefault(),!eL.current){x(window.location.href);return}if(et||!(null==ef?void 0:ef.id))return;let a=eT.current.value.trim();if(!a)return;let{url:o,target:l}=null!==(n=eN(a))&&void 0!==n?n:{};if(o&&"_blank"===l){window.open(o,"_blank");return}if(o){Q.push(o);return}let s={apiKey:(0,T.Pi)(),model:ez.current,lore:eF.current,promptSource:"url-bar",clientId:null===(t=eB.current)||void 0===t?void 0:t.id,siteId:c()};if(e.preventDefault(),ev||(null===(r=V.current)||void 0===r||r.focus(),en(!0),Y.current=!0),a.includes("\n")?1:/^\w+:\/\//i.test(a)?0:/\.[^/]+/.test(a)?a.includes(" "):1)ev||(el([...eo.slice(0,eu+1),{...ef,id:s.siteId,url:"",title:"",command:a,debug:{messages:[{id:"".concat(s.siteId,"-user"),role:"user",content:(0,d.RH)(a)}]}}]),ed(eu+1)),eP({currentId:ef.id,command:a,method:"eval",...s},eH.current,ev);else{let e;if(!ev){let e=(0,i.v)(a);el([...eo.slice(0,eu+1),{url:a,title:e,method:"GET",id:s.siteId,debug:{messages:[{id:"".concat(s.siteId,"-user"),role:"user",content:(0,d.ZD)(a)}]}}]),ed(eu+1),document.title=(0,i.v)(a)}eP({currentId:ef.id,url:(e=a,/^\w+:\/\//i.test(e)||(e="https://".concat(e)),e),method:"GET",...s},eH.current,ev)}ev||eQ(!1)},children:(0,r.jsx)("div",{className:"flex-1 h-8",children:(0,r.jsx)(ew,{newTabMode:ev,submit:()=>{var e;null===(e=X.current)||void 0===e||e.dispatchEvent(new Event("submit",{bubbles:!0,cancelable:!0}))}})})})})}}let eP=async function(e,t){var n,r;let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=new URL(window.location.href),o={temperature:a.searchParams.get("temperature"),model:a.searchParams.get("model")},l={...e,apiKey:(0,T.Pi)(),model:null!==(r=o.model)&&void 0!==r?r:e.model,temperature:o.temperature?parseFloat(o.temperature):void 0};if(i){eL(l);let e="".concat(window.location.origin,"/c/").concat(l.siteId);window.open(e,"_blank");return}eL(l),null===(n=t.loadPage)||void 0===n||n.call(t,l.siteId),t.cacheProfileForSite(l.siteId,t.currentUserProfile)},eL=async e=>{let t=await fetch("/api/html",{method:"PUT",body:JSON.stringify(e),headers:{"content-type":"application/json"}});if(!(await t.json()).ok)throw Error("Failed to put html")},eR=(e,t)=>new URL("".concat(window.location.origin,"/api/render_html").concat(t)).toString();async function eS(){let e=(0,v.e)();await e.auth.signOut(),window.location.href="/"}async function e_(e){e&&navigator.sendBeacon("/api/end_view",JSON.stringify({view_uuid:e}))}},18712:function(e,t,n){"use strict";n.d(t,{Ug:function(){return N},Ym:function(){return I},jc:function(){return j},E6:function(){return E},aX:function(){return k},fz:function(){return w},Tf:function(){return p},cS:function(){return b},Nr:function(){return y},HL:function(){return P}});var r=n(37821),i=n(30520),a=n(14581),o=n(75380),l=n(77452),s=n(58078),u=function(){let[e,t]=(0,s.useState)(!1);function n(e){t(e.metaKey)}function r(){document.hidden&&t(!1)}return(0,s.useEffect)(()=>(window.addEventListener("keydown",n),window.addEventListener("keyup",n),window.addEventListener("visibilitychange",r),window.addEventListener("mousemove",n),()=>{window.removeEventListener("keydown",n),window.removeEventListener("keyup",n),window.removeEventListener("visibilitychange",r),window.removeEventListener("mousemove",n)}),[]),[e,t]},d=n(87601),c=n(18151),h=n(22920),f=n(17344),m=n(56942),v=n(71786),x=n(23133),g=n(59792);let p=(0,s.createContext)(void 0),w=(0,s.createContext)(void 0);function b(){let e=(0,s.useContext)(x.W7);return(0,s.useCallback)(t=>{e((0,h.Uy)(e=>{(null==e?void 0:e.attachments)&&(e.attachments=(0,h.Js)(e.attachments).filter(e=>e.id!==t))}))},[e])}function y(){let e=(0,s.useContext)(f.Ec),t=(0,v.Wo)(),n=(0,s.useContext)(p),r=(0,s.useContext)(j),i=(0,s.useContext)(l.JI),a=(0,s.useContext)(l.ze),u=(0,s.useContext)(x.n8);if(!e||!t)return!1;let d=[a&&a.attachments!==(null==u?void 0:u.attachments),t.id&&!(0,o.kM)(t.id)&&n!==C(t.url),i&&r!==i];return!!d.some(Boolean)||d.some(Boolean)}let j=(0,s.createContext)(void 0),k=(0,s.createContext)(null);function C(e){let t=window.location.origin;return e.replace(t,"https://websim.ai")}let N=(0,s.createContext)(!1),E=(0,s.createContext)(null);function I(e){let[t,n]=(0,s.useState)(""),i=(0,s.useMemo)(()=>C(t),[t]),a=(0,s.useCallback)(e=>{if(!g.env.IS_PRODUCTION_ENVIRONMENT){if("string"==typeof e){n(C(e));return}if("function"==typeof e){n(t=>C(e(t)));return}}n(e)},[n]),[d,c]=(0,s.useState)(void 0),h=(0,v.Wo)(),f=(0,l.M6)(),[b,y]=u(),[I,P]=(0,s.useState)(void 0),L=b&&"opus"===I?"sonnet":I;(0,s.useEffect)(()=>{h||c(void 0)},[h]);let R=(0,m.rV)(),[S]=(0,l.r$)();(0,s.useRef)().current=S,(0,s.useEffect)(()=>{if(f)P(f);else{var e;P(null!==(e=null==R?void 0:R.model)&&void 0!==e?e:void 0)}},[f,null==R?void 0:R.model]);let _=(0,s.useContext)(l.cC);return(0,s.useEffect)(()=>{if((0,o.kM)(_)){var e;P(null!==(e=null==R?void 0:R.model)&&void 0!==e?e:void 0)}},[_,null==R?void 0:R.model]),(0,r.jsx)(p.Provider,{value:i,children:(0,r.jsx)(w.Provider,{value:a,children:(0,r.jsx)(j.Provider,{value:L,children:(0,r.jsx)(k.Provider,{value:P,children:(0,r.jsx)(x.q4,{children:(0,r.jsx)(N.Provider,{value:b,children:(0,r.jsx)(E.Provider,{value:y,children:e.children})})})})})})})}function P(){let e=(0,s.useContext)(x.W7),t=(0,d.useQueryClient)();return(0,c.useMutation)({mutationFn:async e=>{let t={id:(0,i.ad)(),dataUri:e},n=await fetch("/omegabus/attachment",{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}});return i.Pg.parse(await n.json())},onSuccess:async n=>(t.setQueryData(["attachment",n.id],n),t.setQueryData(["attachments"],e=>e?[n,...e]:[n]),console.log("attachment",n),e(e=>{var t;return{...null!=e?e:(0,a.Cs)(),attachments:[...null!==(t=null==e?void 0:e.attachments)&&void 0!==t?t:[],{id:n.id,mediaType:n.mediaType}]}}),n)})}},22257:function(e,t,n){"use strict";n.d(t,{AW:function(){return a},Ao:function(){return o},Bg:function(){return l},RV:function(){return c},qm:function(){return s}});var r=n(37821),i=n(58078);let a=(0,i.createContext)(null),o=(0,i.createContext)(null),l=(0,i.createContext)(null),s=(0,i.createContext)(null),u=(0,i.createContext)(null),d=(0,i.createContext)(null);function c(e){let t=(0,i.useRef)(null),n=(0,i.useRef)(null),[c,h]=(0,i.useState)(!1),[f,m]=(0,i.useState)(!1);return(0,r.jsx)(u.Provider,{value:m,children:(0,r.jsx)(d.Provider,{value:f,children:(0,r.jsx)(a.Provider,{value:t,children:(0,r.jsx)(o.Provider,{value:n,children:(0,r.jsx)(l.Provider,{value:h,children:(0,r.jsx)(s.Provider,{value:c,children:e.children})})})})})})}}},function(e){e.O(0,[951,71,78,596,541,13,705,115,362,744],function(){return e(e.s=97737)}),_N_E=e.O()}]);